syntax = "proto3";
package evnode.v1;

import "google/protobuf/timestamp.proto";
import "evnode/v1/evnode.proto";

option go_package = "github.com/evstack/ev-node/types/pb/evnode/v1";

// State is the state of the blockchain.
message State {
  evnode.v1.Version version = 1;
  string chain_id = 2;
  uint64 initial_height = 3;
  uint64 last_block_height = 4;
  google.protobuf.Timestamp last_block_time = 5;
  uint64 da_height = 6;
  bytes app_hash = 8;
  bytes last_header_hash = 9;

  reserved 7;
}

// SequencerDACheckpoint tracks the position in the DA where transactions were last processed
message SequencerDACheckpoint {
  // DA block height being processed
  uint64 da_height = 1;
  // Index of the next transaction to process within the DA block's forced inclusion batch
  uint64 tx_index = 2;
}

// ExecMeta tracks execution state per height for idempotent execution.
// This enables crash recovery and prevents sibling block creation on retries.
message ExecMeta {
  // Block height this execution metadata is for
  uint64 height = 1;
  // EL parent block hash used for this execution
  bytes parent_hash = 2;
  // Engine API payload ID (optional, set after forkchoiceUpdatedV3)
  bytes payload_id = 3;
  // EL block hash once built (set after getPayloadV4)
  bytes block_hash = 4;
  // State root from the execution payload
  bytes state_root = 5;
  // Hash of the transaction list for sanity checks
  bytes tx_hash = 6;
  // Block timestamp
  int64 timestamp = 7;
  // Current execution stage: "started", "built", "submitted", "promoted"
  string stage = 8;
  // Unix timestamp when this metadata was last updated
  int64 updated_at_unix = 9;
}
