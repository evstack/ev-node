import{_ as r,c as s,ag as a,b as n,w as i,af as l,B as c,o as t,G as d,a as h}from"./chunks/framework.CmpABV1Y.js";const q=JSON.parse('{"title":"ADR 020: Validation Flow for Single Sequencer","description":"","frontmatter":{"head":[["meta",{"name":"og:title","content":"ADR 020: Validation Flow for Single Sequencer | Evolve"},{"name":"og:description","content":false}]]},"headers":[],"relativePath":"adr/adr-020-validation.md","filePath":"adr/adr-020-validation.md","lastUpdated":1753098206000}'),u={name:"adr/adr-020-validation.md"};function p(f,e,m,g,b,v){const o=c("Mermaid");return t(),s("div",null,[e[1]||(e[1]=a('<h1 id="adr-020-validation-flow-for-single-sequencer" tabindex="-1">ADR 020: Validation Flow for Single Sequencer <a class="header-anchor" href="#adr-020-validation-flow-for-single-sequencer" aria-label="Permalink to &quot;ADR 020: Validation Flow for Single Sequencer&quot;">​</a></h1><h2 id="changelog" tabindex="-1">Changelog <a class="header-anchor" href="#changelog" aria-label="Permalink to &quot;Changelog&quot;">​</a></h2><ul><li>2025-04-08: Initial draft</li><li>2025-04-23: Renumbered from ADR-013 to ADR-020 to maintain chronological order.</li></ul><h2 id="context" tabindex="-1">Context <a class="header-anchor" href="#context" aria-label="Permalink to &quot;Context&quot;">​</a></h2><p>In the single sequencer model, a single designated sequencer proposes blocks. To ensure correctness and prevent censorship or fraud, full nodes independently verify proposed headers and associated batches. This ADR describes the validation process involved, both in terms of header/batch verification and forkchoice-safe propagation over the p2p network.</p><p>This model enables fast confirmation by gossiping proposed headers and batches, while allowing full nodes to maintain the security guarantees by performing their own validation and verification of data availability.</p><h2 id="alternative-approaches" tabindex="-1">Alternative Approaches <a class="header-anchor" href="#alternative-approaches" aria-label="Permalink to &quot;Alternative Approaches&quot;">​</a></h2><p>Other models, such as based sequencing or leaderless batching, avoid reliance on a single sequencer but introduce potential latency and sometimes complexity. This ADR focuses on a performant solution for a single sequencer setup.</p><h2 id="decision" tabindex="-1">Decision <a class="header-anchor" href="#decision" aria-label="Permalink to &quot;Decision&quot;">​</a></h2><p>We adopt a validation design that ensures safety through two layers of verification:</p><ol><li><strong>Forkchoice verification</strong> for p2p gossip safety.</li><li><strong>Header-batch consistency and signature validation</strong> by full nodes.</li></ol><h2 id="detailed-design" tabindex="-1">Detailed Design <a class="header-anchor" href="#detailed-design" aria-label="Permalink to &quot;Detailed Design&quot;">​</a></h2><h3 id="entities-involved" tabindex="-1">Entities Involved <a class="header-anchor" href="#entities-involved" aria-label="Permalink to &quot;Entities Involved&quot;">​</a></h3><ul><li><p><strong>Proposer (Sequencer):</strong></p><ul><li>Collects user transactions</li><li>Builds a batch and submits it to the DA layer</li><li>Constructs batchData ([]ID), where each ID = DAHeight + Commitment</li><li>Applies batch to compute state update and forms a header, signs the header</li><li>Publishes header and batch via p2p gossip</li><li>Stores header on DA layer</li></ul></li><li><p><strong>Full Node:</strong></p><ul><li>Receives the batch and header via gossip</li><li>Validates that the gossip update respects forkchoice</li><li>Checks the header signature</li><li>Verifies the batch against the header (DA proofs and commitments)</li><li>Applies the batch to recompute state root and match the state root in the proposed header</li></ul></li></ul><h3 id="verification-pipeline" tabindex="-1">Verification Pipeline <a class="header-anchor" href="#verification-pipeline" aria-label="Permalink to &quot;Verification Pipeline&quot;">​</a></h3><p>The full node performs the following validations:</p><h4 id="_1-forkchoice-safe-verification-for-p2p-gossip" tabindex="-1">1. Forkchoice Safe Verification (for P2P Gossip) <a class="header-anchor" href="#_1-forkchoice-safe-verification-for-p2p-gossip" aria-label="Permalink to &quot;1. Forkchoice Safe Verification (for P2P Gossip)&quot;">​</a></h4><p>P2P gossip propagation requires <code>Verify(untrusted, trusted)</code>:</p><ul><li>Verify that <code>untrusted.LastHash == trusted.Hash()</code></li><li>This check ensures linearity and prevents equivocation in gossip</li><li>This forkchoice check is performed <strong>before</strong> header and batch validation</li></ul><p>If this verification fails, the gossip update is dropped.</p><h4 id="_2-header-vs-batch-validation" tabindex="-1">2. Header vs Batch Validation <a class="header-anchor" href="#_2-header-vs-batch-validation" aria-label="Permalink to &quot;2. Header vs Batch Validation&quot;">​</a></h4><p>Once the gossip message passes forkchoice check:</p><ul><li>Signature Validation: <ul><li>Check the signature of the sequencer (proposer) on the header</li></ul></li><li>Use <code>VerifyBatch(batchData)</code>: <ul><li>Extract the <code>[]ID</code> from header</li><li>Each ID encodes DA height + commitment</li><li>Query DA layer to fetch proofs using <code>GetProofs(batch data, batch namespace)</code></li><li>Calls <code>Validate(proofs, batch data, batch namespace)</code></li><li>Reconstruct commitment locally and match it with commitment in ID to ensure that batch actually corresponds to the batch data in header</li></ul></li><li>State Root Verification: <ul><li>Re-execute batch using local execution layer</li><li>Recompute state root and match with header&#39;s declared root</li></ul></li></ul><p>Only if all of the above pass, the header is marked as valid and added to forkchoice.</p><h3 id="diagram" tabindex="-1">Diagram <a class="header-anchor" href="#diagram" aria-label="Permalink to &quot;Diagram&quot;">​</a></h3>',25)),(t(),n(l,null,{default:i(()=>[d(o,{id:"mermaid-235",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20U%20as%20User%0A%20%20%20%20participant%20P%20as%20Proposer%0A%20%20%20%20participant%20FN%20as%20Full%20Node%0A%0A%20%20%20%20U-%3E%3EP%3A%20Submit%20Tx%0A%20%20%20%20P-%3E%3EDA%3A%20Publish%20Batch%20to%20DA%0A%20%20%20%20P-%3E%3EP%3A%20Compute%20BatchData%20(DAHeight%20%7C%7C%20Commitment)%0A%20%20%20%20P-%3E%3EP%3A%20Execute%20batch%20and%20compute%20new%20state%20root%0A%20%20%20%20P-%3E%3EFN%3A%20Gossip%20Header%20%2B%20Batch%0A%0A%20%20%20%20Note%20over%20FN%3A%20On%20Gossip%20Receive%3A%0A%20%20%20%20FN-%3E%3EFN%3A%20Verify(untrusted%2C%20trusted)%0A%20%20%20%20alt%20forkchoice%20passes%0A%20%20%20%20%20%20FN-%3E%3EDA%3A%20Fetch%20Blobs%20for%20BatchData%0A%20%20%20%20%20%20FN-%3E%3EFN%3A%20Compute%20and%20match%20Commitments%0A%20%20%20%20%20%20FN-%3E%3EFN%3A%20Verify%20Sequencer%20Signature%0A%20%20%20%20%20%20FN-%3E%3EFN%3A%20Re-execute%20Batch%0A%20%20%20%20%20%20FN-%3E%3EFN%3A%20Confirm%20State%20Root%0A%20%20%20%20else%20forkchoice%20fails%0A%20%20%20%20%20%20FN--%3E%3EP%3A%20Drop%20gossip%20message%0A%20%20%20%20end%0A"})]),fallback:i(()=>e[0]||(e[0]=[h(" Loading... ")])),_:1})),e[2]||(e[2]=a('<h2 id="status" tabindex="-1">Status <a class="header-anchor" href="#status" aria-label="Permalink to &quot;Status&quot;">​</a></h2><p>Proposed</p><h2 id="consequences" tabindex="-1">Consequences <a class="header-anchor" href="#consequences" aria-label="Permalink to &quot;Consequences&quot;">​</a></h2><h3 id="positive" tabindex="-1">Positive <a class="header-anchor" href="#positive" aria-label="Permalink to &quot;Positive&quot;">​</a></h3><ul><li>Ensures full nodes validate every state transition</li><li>Forkchoice check ensures linear chain progression and safe gossip</li><li>Protects against malicious proposers submitting invalid batches or headers</li></ul><h3 id="negative" tabindex="-1">Negative <a class="header-anchor" href="#negative" aria-label="Permalink to &quot;Negative&quot;">​</a></h3><ul><li>Still relies on a trusted sequencer for liveness</li><li>Full validation increases complexity on full nodes</li></ul><h3 id="neutral" tabindex="-1">Neutral <a class="header-anchor" href="#neutral" aria-label="Permalink to &quot;Neutral&quot;">​</a></h3><ul><li>This ADR aligns with current implementation direction for single-sequencer-based applications</li></ul><h2 id="references" tabindex="-1">References <a class="header-anchor" href="#references" aria-label="Permalink to &quot;References&quot;">​</a></h2>',10))])}const P=r(u,[["render",p]]);export{q as __pageData,P as default};
